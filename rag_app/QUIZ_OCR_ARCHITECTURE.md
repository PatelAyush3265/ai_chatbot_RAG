# Quiz Generator with OCR - Complete Architecture

## System Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER INTERFACE                                 â”‚
â”‚                    (Quiz Generator Modal)                               â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  File Upload Input                                             â”‚   â”‚
â”‚  â”‚  Accept: .pdf, .txt, .md, .png, .jpg, .jpeg, .tiff, .bmp, .gifâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Upload File
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FASTAPI BACKEND (/quiz/upload)                      â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    File Type Detection                           â”‚ â”‚
â”‚  â”‚  allowed_extensions = ['.pdf', '.txt', '.md',                    â”‚ â”‚
â”‚  â”‚                        '.png', '.jpg', '.jpeg',                  â”‚ â”‚
â”‚  â”‚                        '.tiff', '.bmp', '.gif']                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚                 â”‚                 â”‚                     â”‚
â”‚              â–¼                 â–¼                 â–¼                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚  Text File      â”‚ â”‚    PDF      â”‚ â”‚     Image       â”‚           â”‚
â”‚    â”‚  (.txt, .md)    â”‚ â”‚   (.pdf)    â”‚ â”‚ (.png, .jpg,..) â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚             â”‚                 â”‚                  â”‚                     â”‚
â”‚             â”‚                 â”‚                  â”‚                     â”‚
â”‚             â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                     â”‚
â”‚             â”‚        â”‚                 â”‚         â”‚                     â”‚
â”‚             â”‚        â–¼                 â–¼         â”‚                     â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                     â”‚
â”‚             â”‚  â”‚Text PDF  â”‚     â”‚Scanned/  â”‚    â”‚                     â”‚
â”‚             â”‚  â”‚(has text)â”‚     â”‚Image PDF â”‚    â”‚                     â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚                     â”‚
â”‚             â”‚       â”‚                â”‚          â”‚                     â”‚
â”‚             â”‚       â”‚                â–¼          â”‚                     â”‚
â”‚             â”‚       â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚             â”‚       â”‚        â”‚   OCR PROCESSOR            â”‚           â”‚
â”‚             â”‚       â”‚        â”‚   (ocr_utils.py)           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚       â”‚        â”‚                            â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚ 1. Preprocess Image  â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    - Grayscale       â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    - Denoise         â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    - Border Removal  â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    - CLAHE           â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    - Threshold       â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚                            â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚ 2. Convert PDF Pages â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    (using Poppler)   â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚                            â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚ 3. Run Tesseract OCR â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    - Extract Text    â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚                            â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚ 4. Save to Temp File â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â”‚    filename_ocr.txt  â”‚  â”‚           â”‚
â”‚             â”‚       â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚             â”‚       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚             â”‚       â”‚                     â”‚                           â”‚
â”‚             â”‚       â”‚                     â”‚                           â”‚
â”‚             â–¼       â–¼                     â–¼                           â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚      â”‚     EXTRACTED TEXT (from all sources)    â”‚                     â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                       â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Pass to Quiz Processor
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QUIZ PROCESSOR (quiz_document_processor.py)          â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 1-2: Text Extraction & Chunking                           â”‚ â”‚
â”‚  â”‚  - Read text content                                             â”‚ â”‚
â”‚  â”‚  - Split into chunks (500 chars, 100 overlap)                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 3-4: Tokenization & Embedding Generation                  â”‚ â”‚
â”‚  â”‚  - Use sentence-transformers                                     â”‚ â”‚
â”‚  â”‚  - Create vector embeddings                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QUIZ HYBRID RETRIEVER (quiz_hybrid_retriever.py)     â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 5: Store in Vector Database                               â”‚ â”‚
â”‚  â”‚  - Store embeddings in ChromaDB                                  â”‚ â”‚
â”‚  â”‚  - Index with session_id                                         â”‚ â”‚
â”‚  â”‚  - Enable hybrid retrieval (Cosine + BM25)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Ready for Quiz Generation
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 USER CONFIGURES QUIZ PARAMETERS                         â”‚
â”‚  - Topic: "machine learning"                                           â”‚
â”‚  - Number of questions: 5                                              â”‚
â”‚  - Difficulty: mixed                                                   â”‚
â”‚  - Use expansion: true                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Click "Generate Quiz"
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     QUIZ GENERATION (/quiz/generate)                    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 1: Retrieve Relevant Chunks                               â”‚ â”‚
â”‚  â”‚  - Hybrid retrieval from vector DB                               â”‚ â”‚
â”‚  â”‚  - Cosine similarity (0.7) + BM25 (0.3)                          â”‚ â”‚
â”‚  â”‚  - Optional query expansion                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 2: Generate Questions                                      â”‚ â”‚
â”‚  â”‚  - Use Groq LLM (Llama model)                                    â”‚ â”‚
â”‚  â”‚  - Create MCQs from context                                      â”‚ â”‚
â”‚  â”‚  - Generate options and explanations                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 3: Save Quiz                                               â”‚ â”‚
â”‚  â”‚  - Save as JSON (structured data)                                â”‚ â”‚
â”‚  â”‚  - Save as TXT (human-readable)                                  â”‚ â”‚
â”‚  â”‚  - Store in quiz_outputs/                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          QUIZ DELIVERED TO USER                         â”‚
â”‚                                                                         â”‚
â”‚  Questions displayed in UI                                             â”‚
â”‚  Download buttons available (JSON, TXT)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Summary

### Input Types and Processing

| Input Type | Processing Path | OCR Used | Output |
|------------|----------------|----------|---------|
| Text File (.txt, .md) | Direct â†’ Processor | âŒ No | Text chunks |
| Text PDF | Standard extraction â†’ Processor | âŒ No | Text chunks |
| Scanned PDF | OCR extraction â†’ Temp file â†’ Processor | âœ… Yes | Text chunks |
| Image (PNG, JPG, etc.) | OCR extraction â†’ Temp file â†’ Processor | âœ… Yes | Text chunks |

### OCR Processing Steps (for Images & Scanned PDFs)

1. **Input Validation** â†’ Check file extension
2. **OCR Detection** â†’ Determine if OCR needed
3. **Preprocessing** â†’ Enhance image quality
4. **Text Extraction** â†’ Run Tesseract OCR
5. **Temp File Creation** â†’ Save extracted text
6. **Standard Processing** â†’ Process as text file
7. **Error Handling** â†’ Fallback for PDFs

### Quiz Generation Pipeline

1. **Upload** â†’ File saved to quiz_uploads/
2. **Extract** â†’ Text extracted (OCR if needed)
3. **Chunk** â†’ Split into 500-char chunks
4. **Embed** â†’ Generate vector embeddings
5. **Store** â†’ Index in ChromaDB
6. **Retrieve** â†’ Search relevant chunks
7. **Generate** â†’ Create MCQs with LLM
8. **Save** â†’ Export JSON/TXT files

## Component Interaction

```
OCR Utils â†â”€â”€â”€â”€â”€â”€â”
     â”‚           â”‚
     â†“           â”‚
Quiz Upload  â†’  OCR Processor  â†’  Temp Text File
     â”‚                                   â”‚
     â”‚                                   â†“
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  Quiz Processor  â†â”€â”€â”˜
                          â”‚
                          â†“
                   Quiz Retriever
                          â”‚
                          â†“
                   Vector Database (ChromaDB)
                          â”‚
                          â†“
                   Quiz Generator
                          â”‚
                          â†“
                   Output Files (JSON/TXT)
```

## Session Management

```
quiz_sessions[session_id] = {
    'filename': 'screenshot.png',
    'file_path': '/path/to/file',
    'num_chunks': 15,
    'chunks': [...],
    'embeddings_stored': True,
    'quiz': {
        'questions': [...],
        'json_path': '...',
        'txt_path': '...',
        'json_filename': '...',
        'txt_filename': '...'
    }
}
```

## Error Handling Flow

```
Try OCR Processing
       â†“
   Success? â”€â”€Yesâ”€â”€â†’ Use Extracted Text
       â”‚
       No
       â†“
   Is PDF?
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
  Yes     No
   â”‚       â”‚
   â”‚       â””â”€â”€â†’ Return Error
   â”‚            (Images require OCR)
   â†“
Fallback to
Standard PDF
Extraction
   â†“
Continue Processing
```

## File Storage Structure

```
rag_app/
â”œâ”€â”€ quiz_uploads/          # Uploaded files
â”‚   â”œâ”€â”€ quiz_abc123_screenshot.png
â”‚   â”œâ”€â”€ quiz_abc123_screenshot_ocr.txt  # OCR output
â”‚   â””â”€â”€ quiz_def456_document.pdf
â”‚
â””â”€â”€ quiz_outputs/          # Generated quizzes
    â”œâ”€â”€ quiz_machine_learning_20251212_143022.json
    â””â”€â”€ quiz_machine_learning_20251212_143022.txt
```

## Integration Points

### 1. OCR Utils Integration
- **Location:** `backend/ocr_utils.py`
- **Usage:** Called from `/quiz/upload`
- **Method:** `ocr_processor.extract_text()`

### 2. Quiz Processor Integration
- **Location:** `backend/quiz_document_processor.py`
- **Usage:** Processes text (from OCR or direct)
- **Method:** `quiz_processor.process_file()`

### 3. Vector Storage Integration
- **Location:** `backend/quiz_hybrid_retriever.py`
- **Usage:** Stores embeddings with session ID
- **Method:** `quiz_retriever.index_chunks()`

### 4. Frontend Integration
- **Location:** `ai-chat-react/src/components/modals/QuizGeneratorModal.jsx`
- **Usage:** File upload validation
- **Changes:** Accept attribute, error messages

## Performance Metrics

### Processing Time Breakdown

**Image Upload (3 MB PNG):**
1. Upload to server: ~0.5 sec
2. OCR processing: ~4 sec
3. Chunking: ~0.3 sec
4. Embedding generation: ~2 sec
5. Vector DB storage: ~0.5 sec
**Total: ~7.3 seconds**

**Scanned PDF (10 pages):**
1. Upload to server: ~1 sec
2. OCR processing: ~45 sec
3. Chunking: ~1 sec
4. Embedding generation: ~5 sec
5. Vector DB storage: ~1 sec
**Total: ~53 seconds**

**Text PDF (10 pages):**
1. Upload to server: ~1 sec
2. Text extraction: ~2 sec
3. Chunking: ~1 sec
4. Embedding generation: ~5 sec
5. Vector DB storage: ~1 sec
**Total: ~10 seconds**

## Success Indicators

When functioning correctly, backend logs show:

```
ğŸ“„ Quiz file uploaded: image.png
ğŸ” Running OCR on image.png
Step 1-2: Text extraction and chunking...
âœ… OCR completed: 12 chunks extracted from image.png
Step 3-4: Tokenization and embedding generation...
Step 5: Storing embeddings in vector database...
âœ“ RAG Pipeline Complete: 12 chunks processed and stored in vector DB
```

This confirms:
- âœ… File received
- âœ… OCR initiated
- âœ… Text extracted
- âœ… Chunks created
- âœ… Embeddings generated
- âœ… Vector DB updated
- âœ… Ready for quiz generation
